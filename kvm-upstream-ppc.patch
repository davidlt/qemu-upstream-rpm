From 796d42657fb238cf23a78620051f533662557e2b Mon Sep 17 00:00:00 2001
From: Glauber Costa <glommer@redhat.com>
Date: Fri, 13 Feb 2009 13:00:31 -0500
Subject: [PATCH] use KVM_UPSTREAM for ppc.

ppc should compile with upstream qemu code, so, put these
defines in ppc specific code that references kvm functions.

We don put them in config.h in this case, since there are
files (like vl.c) that includes both kvm.h and qemu-kvm.h,
and would break compilation.

Signed-off-by: Glauber Costa <glommer@redhat.com>
---
 hw/ppc440.c            |    1 +
 hw/ppc440_bamboo.c     |    1 +
 hw/ppce500_mpc8544ds.c |    1 +
 target-ppc/helper.c    |    2 +-
 4 files changed, 4 insertions(+), 1 deletion(-)

Index: qemu-kvm-0.10.4/hw/ppc440.c
===================================================================
--- qemu-kvm-0.10.orig/qemu/hw/ppc440.c
+++ qemu-kvm-0.10.4/hw/ppc440.c
@@ -18,6 +18,7 @@
 #include "ppc440.h"
 #include "ppc405.h"
 #include "sysemu.h"
+#define KVM_UPSTREAM
 #include "kvm.h"
 
 #define PPC440EP_PCI_CONFIG     0xeec00000
Index: qemu-kvm-0.10.4/hw/ppc440_bamboo.c
===================================================================
--- qemu-kvm-0.10.orig/qemu/hw/ppc440_bamboo.c
+++ qemu-kvm-0.10.4/hw/ppc440_bamboo.c
@@ -21,6 +21,7 @@
 #include "boards.h"
 #include "sysemu.h"
 #include "ppc440.h"
+#define KVM_UPSTREAM
 #include "kvm.h"
 #include "kvm_ppc.h"
 #include "device_tree.h"
Index: qemu-kvm-0.10.4/hw/ppce500_mpc8544ds.c
===================================================================
--- qemu-kvm-0.10.orig/qemu/hw/ppce500_mpc8544ds.c
+++ qemu-kvm-0.10.4/hw/ppce500_mpc8544ds.c
@@ -16,6 +16,7 @@
 
 #include <dirent.h>
 
+#define KVM_UPSTREAM
 #include "config.h"
 #include "qemu-common.h"
 #include "net.h"
Index: qemu-kvm-0.10.4/target-ppc/helper.c
===================================================================
--- qemu-kvm-0.10.orig/qemu/target-ppc/helper.c
+++ qemu-kvm-0.10.4/target-ppc/helper.c
@@ -29,6 +29,7 @@
 #include "exec-all.h"
 #include "helper_regs.h"
 #include "qemu-common.h"
+#define KVM_UPSTREAM
 #include "kvm.h"
 
 //#define DEBUG_MMU
